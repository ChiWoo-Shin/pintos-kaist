
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Indexed and Extensible Files Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="subdirectories.html" />
    
    
    <link rel="prev" href="introduction.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../introduction/getting_started.html">
            
                <a href="../introduction/getting_started.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../introduction/grading.html">
            
                <a href="../introduction/grading.html">
            
                    
                    Grading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../introduction/legal_and_ethical_issues.html">
            
                <a href="../introduction/legal_and_ethical_issues.html">
            
                    
                    Legal and Ethical Issues
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Project1: Threads</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../project1/introduction.html">
            
                <a href="../project1/introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../project1/alarm_clock.html">
            
                <a href="../project1/alarm_clock.html">
            
                    
                    Alarm Clock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../project1/priority_scheduling.html">
            
                <a href="../project1/priority_scheduling.html">
            
                    
                    Priority Scheduling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../project1/advanced_scheduler.html">
            
                <a href="../project1/advanced_scheduler.html">
            
                    
                    Advanced Scheduler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../project1/FAQ.html">
            
                <a href="../project1/FAQ.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Project2: User Programs</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../project2/introduction.html">
            
                <a href="../project2/introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../project2/argument_passing.html">
            
                <a href="../project2/argument_passing.html">
            
                    
                    Argument Passing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../project2/user_memory.html">
            
                <a href="../project2/user_memory.html">
            
                    
                    User Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../project2/system_call.html">
            
                <a href="../project2/system_call.html">
            
                    
                    System Calls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../project2/process_termination.html">
            
                <a href="../project2/process_termination.html">
            
                    
                    Process Termination Messages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../project2/deny_write.html">
            
                <a href="../project2/deny_write.html">
            
                    
                    Denying Writes to Executables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="../project2/dup.html">
            
                <a href="../project2/dup.html">
            
                    
                    Extend File Descriptor (Extra)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="../project2/FAQ.html">
            
                <a href="../project2/FAQ.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Project3: Virtual Memory</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../project3/introduction.html">
            
                <a href="../project3/introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../project3/vm_management.html">
            
                <a href="../project3/vm_management.html">
            
                    
                    Memory Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../project3/anon.html">
            
                <a href="../project3/anon.html">
            
                    
                    Anonymous Page
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../project3/stack_growth.html">
            
                <a href="../project3/stack_growth.html">
            
                    
                    Stack Growth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../project3/memory_mapped_files.html">
            
                <a href="../project3/memory_mapped_files.html">
            
                    
                    Memory Mapped Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../project3/swapping.html">
            
                <a href="../project3/swapping.html">
            
                    
                    Swap In/Out
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="../project3/cow.html">
            
                <a href="../project3/cow.html">
            
                    
                    Copy-on-Write (Extra)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="../project3/FAQ.html">
            
                <a href="../project3/FAQ.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Project4: File System</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="introduction.html">
            
                <a href="introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="5.2" data-path="indexed_and_extensible_files.html">
            
                <a href="indexed_and_extensible_files.html">
            
                    
                    Indexed and Extensible Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="subdirectories.html">
            
                <a href="subdirectories.html">
            
                    
                    Subdirectories and Soft Links
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="buffer_cache.html">
            
                <a href="buffer_cache.html">
            
                    
                    Buffer Cache (Extra)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="synchronization.html">
            
                <a href="synchronization.html">
            
                    
                    Synchronization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="FAQ.html">
            
                <a href="FAQ.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Appendix</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../appendix/threads.html">
            
                <a href="../appendix/threads.html">
            
                    
                    Threads
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../appendix/synchronization.html">
            
                <a href="../appendix/synchronization.html">
            
                    
                    Synchronization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../appendix/memory_allocation.html">
            
                <a href="../appendix/memory_allocation.html">
            
                    
                    Memory Allocation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="../appendix/virtual_address.html">
            
                <a href="../appendix/virtual_address.html">
            
                    
                    Virtual Address
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="../appendix/page_table.html">
            
                <a href="../appendix/page_table.html">
            
                    
                    Page Table
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="../appendix/debugging_tools.html">
            
                <a href="../appendix/debugging_tools.html">
            
                    
                    Debugging Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.7" data-path="../appendix/development_tools.html">
            
                <a href="../appendix/development_tools.html">
            
                    
                    Development Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.8" data-path="../appendix/hash_table.html">
            
                <a href="../appendix/hash_table.html">
            
                    
                    Hash Table
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Indexed and Extensible Files</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="indexed-and-extensible-files">Indexed and Extensible Files</h2>
<p>The basic file system allocates files as a single extent, making it vulnerable to external
fragmentation, that is, it is possible that an <em>n</em>-block file cannot be allocated even though
<em>n</em> blocks are free (i.e. external fragmentation). Eliminate this problem by modifying the
on-disk inode structure.</p>
<p>In practice, this probably means using an index structure with direct, indirect, and doubly
indirect blocks. In previous semesters, most students adopted something like what you have
learned as <em>Berkeley UNIX FFS</em> with multi-level indexing. However, to make your life easier,
we make you implement it in an easier way: FAT. <strong>You must implement FAT with given skeleton code.</strong>
Your code MUST NOT contain any code for multi-level indexing (FFS in the lecture).
You will receive 0pts for file growth parts.</p>
<p>NOTE: You can assume that the file system partition will not be larger than 8 MB. You must
support files as large as the partition (minus metadata). Each inode is stored in one disk
sector, limiting the number of block pointers that it can contain.</p>
<h3 id="indexing-large-files-with-fat-file-allocation-table">Indexing large files with FAT (File Allocation Table)</h3>
<blockquote>
<p>Warning: this document assumes you have already understood the basic principle of 
general filesystem and FAT from the lecture. If not, please go back to the lecture note
and understand what is filesystem and FAT.</p>
</blockquote>
<p>In the basic filesystem that you have used for the previous projects, a file was stored as a
contiguous single chunk over multiple disk sectors. Let&apos;s call <em>contiguous chunk</em> as <em>cluster</em>,
since a cluster (chunk) can contain one or more contiguous disk sectors. In this point of view,
the size of a cluster in the basic file system was equal to the size of a file that stored in the
cluster.</p>
<p>To mitigate external fragmentation, we can shrink the size of cluster (recall the page size in
virtual memory). For simplicity, in our skeleton code, we fixed number of sectors in a cluster
as <code>1</code>. When we use smaller clusters like it, a cluster might not enough to store the entire file.
In this case, we need multiple clusters for a file, so we need a data structure to index the clusters
for a file in the inode. One of the easiest way is to use linked-list (a.k.a <em>chain</em>). An inode
can contain the sector number of the first block of the file, and the first block
may contain the sector number of the second block. This na&#xEF;ve approach, however, is too slow
because we have to read every block of the file, even though what we really need was only the
last block. To overcome this, FAT (File Allocation Table) puts the connectivity of blocks in
a fixed-size File Allocation Table rather than the blocks themselves. Since FAT only contains the
connectivity value rather than the actual data, its size is small enough to be cached in DRAM.
As a result, we can just read corresponding entries in the table.</p>
<p>You will implement inode indexing with the skeleton code provided in <code>filesys/fat.c</code>. This
section briefly describes what already-implemented functions in <code>fat.c</code> do and what you
should implement.</p>
<p>First of all, 6 functions in <code>fat.c</code> (i.e. <code>fat_init()</code>, <code>fat_open()</code>, <code>fat_close()</code>, <code>fat_create()</code>,
and <code>fat_boot_create()</code>) initialize and format disks at the boot time, so you don&apos;t
have to modify them. However, you&apos;ll need to write <code>fat_fs_init()</code>, and briefly understanding what they
do could be helpful.</p>
<hr>
<pre><code class="lang-C"><span class="hljs-keyword">cluster_t</span> fat_fs_init (<span class="hljs-keyword">void</span>);
</code></pre>
<blockquote>
<p>Initialize FAT file system. You have to initialize <code>fat_length</code> and <code>data_start</code> field of <code>fat_fs</code>.
<code>fat_length</code> stores how many clusters in the filesystem and <code>data_start</code> stores in which sector
we can start to store files. You may want to exploit some values stored in <code>fat_fs-&gt;bs</code>.
Also, you may want to initialize some other useful data in this function.</p>
</blockquote>
<hr>
<pre><code class="lang-C"><span class="hljs-keyword">cluster_t</span> fat_create_chain (<span class="hljs-keyword">cluster_t</span> clst);
</code></pre>
<blockquote>
<p>Extend a chain by appending a cluster after the cluster specified in <code>clst</code> (cluster indexing number).
If <code>clst</code> is equal to zero, then create a new chain. Return the cluster number of newly allocated cluster.</p>
</blockquote>
<hr>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fat_remove_chain</span> <span class="hljs-params">(cluster_t clst, cluster_t pclst)</span></span>;
</code></pre>
<blockquote>
<p>Starting from <code>clst</code>, remove clusters from a chain. <code>pclst</code> should be the direct previous cluster in the chain.
This means, after the execution of this function, <code>pclst</code> should be the last element of the updated chain.
If <code>clst</code> is the first element in the chain, <code>pclst</code> should be 0.</p>
</blockquote>
<hr>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fat_put</span> <span class="hljs-params">(cluster_t clst, cluster_t val)</span></span>;
</code></pre>
<blockquote>
<p>Update FAT entry pointed by cluster number <code>clst</code> to <code>val</code>. Since each entry in FAT points the next
cluster in a chain (if exist; otherwise <code>EOChain</code>), this could be used to update connectivity.</p>
</blockquote>
<hr>
<pre><code class="lang-C"><span class="hljs-keyword">cluster_t</span> fat_get (<span class="hljs-keyword">cluster_t</span> clst);
</code></pre>
<blockquote>
<p>Return in which cluster number the given cluster <code>clst</code> points.</p>
</blockquote>
<hr>
<pre><code class="lang-C"><span class="hljs-keyword">disk_sector_t</span> cluster_to_sector (<span class="hljs-keyword">cluster_t</span> clst);
</code></pre>
<blockquote>
<p>Translates a cluster number <code>clst</code> into the corresponding sector number and return the sector number.</p>
</blockquote>
<hr>
<p>You may wish to exploit these functions in <code>filesys.c</code> and <code>inode.c</code> to augment the basic file system.</p>
<h3 id="file-growth">File Growth</h3>
<p><strong>Implement extensible files.</strong> In the basic file system, the file
size is specified when the file is created. In most modern file systems, however, a file is
initially created with size 0 and is then expanded every time a write is made off the end of
the file. Your file system must allow this.</p>
<p>There should be no predetermined limit on the size of a file, except that a file cannot
exceed the size of the file system (minus metadata). This also applies to the root directory
file, which should now be allowed to expand beyond its initial limit of 16 files.</p>
<p>User programs are allowed to seek beyond the current end-of-file (EOF). The seek itself
does not extend the file. Writing at a position past EOF extends the file to the position
being written, and any gap between the previous EOF and the start of the write must be
filled with zeros. A read starting from a position past EOF returns no bytes.</p>
<p>Writing far beyond EOF can cause many blocks to be entirely zero. Some file systems
allocate and write real data blocks for these implicitly zeroed blocks. Other file systems do
not allocate these blocks at all until they are explicitly written. The latter file systems are
said to support &quot;sparse files.&quot; You may adopt either allocation strategy in your file system.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page: Introduction">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="subdirectories.html" class="navigation navigation-next " aria-label="Next page: Subdirectories and Soft Links">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Indexed and Extensible Files","level":"5.2","depth":1,"next":{"title":"Subdirectories and Soft Links","level":"5.3","depth":1,"path":"project4/subdirectories.md","ref":"project4/subdirectories.md","articles":[]},"previous":{"title":"Introduction","level":"5.1","depth":1,"path":"project4/introduction.md","ref":"project4/introduction.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"project4/indexed_and_extensible_files.md","mtime":"2022-05-23T14:07:34.336Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-05-23T14:13:22.147Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

